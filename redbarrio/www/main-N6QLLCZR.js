import{a as ve}from"./chunk-GC4IB6VA.js";import{b as de,c as fe,d as ge,e as he,f as Ce,g as xe}from"./chunk-5NLYO5NP.js";import{a as we}from"./chunk-PXGXSWQ7.js";import{c as O}from"./chunk-SIZNMXVG.js";import{a as v}from"./chunk-MLOBWV3E.js";import"./chunk-66QFWZLQ.js";import{B as d,C as f,D as p,Eb as _e,Ga as Q,Gb as k,Ha as X,K as c,Na as ee,Ya as te,Z as H,ab as ne,ba as Z,bb as ie,c as j,ca as z,da as J,e as F,eb as oe,f as A,fb as re,ga as $,gb as ae,h as G,hb as ce,i as u,ia as K,ib as se,j as _,ja as S,kb as le,la as Y,ma as T,n as s,o as P,p as W,q as M,s as I,u as q,v as l,w as r,wb as me,x as a,xb as pe,y as m,yb as ue}from"./chunk-LBATYOJ7.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as w}from"./chunk-VI73JOY6.js";var b=(()=>{let n=class n{constructor(o){this.router=o}canActivate(o){return w(this,null,function*(){let t=o.data?.roles??[],{data:{session:g}}=yield v.auth.getSession();if(!g){let h=localStorage.getItem("rb_usuario_activo");if(h)try{let x=JSON.parse(h);return t.length?x?.rol?t.includes(x.rol)?!0:(this.router.navigate(["/home"]),!1):(this.router.navigate(["/auth/login"]),!1):!0}catch{return this.router.navigate(["/auth/login"]),!1}return this.router.navigate(["/auth/login"]),!1}if(!t.length)return!0;let{data:y,error:C}=yield v.from("usuario").select("rol").eq("id_auth",g.user.id).maybeSingle();if(C||!y?.rol){console.warn("No se pudo obtener rol desde Supabase, intentando perfil local:",C);let h=localStorage.getItem("rb_usuario_activo");if(h)try{let x=JSON.parse(h);return x?.rol?t.includes(x.rol)?!0:(this.router.navigate(["/home"]),!1):(this.router.navigate(["/auth/login"]),!1)}catch{return this.router.navigate(["/auth/login"]),!1}return console.error("Error al obtener perfil o rol no definido:",C),this.router.navigate(["/auth/login"]),!1}return t.includes(y.rol)?!0:(console.warn(`\u26D4 Acceso denegado. Rol actual: ${y.rol}, Roles permitidos: ${t.join(", ")}`),this.router.navigate(["/home"]),!1)})}};n.\u0275fac=function(t){return new(t||n)(G(S))},n.\u0275prov=F({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();var Ae=[{path:"",redirectTo:"auth/login",pathMatch:"full"},{path:"auth/login",loadComponent:()=>import("./chunk-ZWZBIJ6X.js").then(e=>e.LoginPage)},{path:"auth/register",loadComponent:()=>import("./chunk-RQVOEENB.js").then(e=>e.RegisterPage)},{path:"solicitar",canActivate:[b],loadComponent:()=>import("./chunk-74LU3WGS.js").then(e=>e.SolicitarCertificadoPage)},{path:"pago-retorno",loadComponent:()=>import("./chunk-VAHOQJ7U.js").then(e=>e.PagoRetornoPage)},{path:"noticias/crear",loadComponent:()=>import("./chunk-WUDW7XNI.js").then(e=>e.CrearNoticiaPage)},{path:"noticias/:id",loadComponent:()=>import("./chunk-53JFWOVT.js").then(e=>e.DetalleNoticiaPage)},{path:"votacion/:id",canActivate:[b],loadComponent:()=>import("./chunk-ZRNR2EVR.js").then(e=>e.VotacionPage)},{path:"votaciones",loadComponent:()=>import("./chunk-QVCS5QEQ.js").then(e=>e.VotacionesListPage)},{path:"solicitud",loadComponent:()=>import("./chunk-24EUZJMF.js").then(e=>e.SolicitudPage)},{path:"perfil",canActivate:[b],loadComponent:()=>import("./chunk-JQGEAHMQ.js").then(e=>e.PerfilPage)},{path:"generar/proyecto",canActivate:[b],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-RMX46O7P.js").then(e=>e.GenerarProyectoComponent)},{path:"dashboard",loadComponent:()=>import("./chunk-M3E72E32.js").then(e=>e.DashboardComponent)},{path:"espacios",loadComponent:()=>import("./chunk-MCI355SC.js").then(e=>e.EspaciosPage)},{path:"espacio/crear",canActivate:[b],loadComponent:()=>import("./chunk-62RQHXD2.js").then(e=>e.CrearEspacioPage)},{path:"espacios/:id",loadComponent:()=>import("./chunk-GLGVA6M4.js").then(e=>e.DetalleEspacioPage)},{path:"generar/votacion",canActivate:[b],data:{roles:["administrador"]},loadComponent:()=>import("./chunk-CHQQ2YAM.js").then(e=>e.GenerarVotacionPage)},{path:"auth/recuperar-contrasena",loadComponent:()=>import("./chunk-CTO6QBKZ.js").then(e=>e.UpdatePasswordPage)},{path:"inscripcion",children:[{path:"proyectos",loadComponent:()=>import("./chunk-WGILR562.js").then(e=>e.ProyectosPage)},{path:"inscripcion-proyecto/:id",loadComponent:()=>import("./chunk-2GRZUOSR.js").then(e=>e.InscripcionProyectoComponent)}]},{path:"home",canActivate:[b],loadComponent:()=>import("./chunk-SKVIVWGN.js").then(e=>e.HomePage)},{path:"**",redirectTo:"auth/login"}],be=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=M({type:n}),n.\u0275inj=A({imports:[T.forRoot(Ae,{preloadingStrategy:Y}),T]});let e=n;return e})();var U=(function(e){return e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT",e})(U||{});var V=O("StatusBar");var L=O("App",{web:()=>import("./chunk-5NLA6BLV.js").then(e=>new e.AppWeb)});function Me(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/home"))}),m(1,"ion-icon",15),r(2,"ion-label"),c(3,"Inicio"),a()()}}function Ie(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/solicitar"))}),m(1,"ion-icon",16),r(2,"ion-label"),c(3,"Solicitar certificado"),a()()}}function Se(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/votaciones"))}),m(1,"ion-icon",17),r(2,"ion-label"),c(3,"Votaciones"),a()()}}function ke(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/inscripcion/proyectos"))}),m(1,"ion-icon",17),r(2,"ion-label"),c(3,"Inscribirse a proyecto/Actividad"),a()()}}function Oe(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/solicitud"))}),m(1,"ion-icon",18),r(2,"ion-label"),c(3,"Arrendar espacio"),a()()}}function Ve(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/espacios"))}),m(1,"ion-icon",19),r(2,"ion-label"),c(3,"Espacios Comunitarios"),a()()}}function Te(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/dashboard"))}),m(1,"ion-icon",19),r(2,"ion-label"),c(3,"Transparencia y Metricas"),a()()}}function Ee(e,n){e&1&&(r(0,"ion-list-header"),c(1,"Administraci\xF3n"),a())}function Ue(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/generar/proyecto"))}),m(1,"ion-icon",20),r(2,"ion-label"),c(3,"Generar proyecto"),a()()}}function Le(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/generar/votacion"))}),m(1,"ion-icon",21),r(2,"ion-label"),c(3,"Generar votaci\xF3n"),a()()}}function Re(e,n){if(e&1){let i=d();r(0,"ion-item",14),f("click",function(){u(i);let t=p(2);return _(t.go("/noticias/crear"))}),m(1,"ion-icon",21),r(2,"ion-label"),c(3,"Generar noticia"),a()()}}function Ne(e,n){if(e&1){let i=d();r(0,"ion-item",22),f("click",function(){u(i);let t=p(2);return _(t.go("/perfil"))}),m(1,"ion-icon",23),r(2,"ion-label"),c(3,"Mi perfil"),a()()}}function De(e,n){if(e&1){let i=d();r(0,"ion-menu",2)(1,"ion-header",3)(2,"ion-toolbar")(3,"ion-title"),c(4,"Men\xFA"),a()()(),r(5,"ion-content",4)(6,"ion-list",5)(7,"ion-menu-toggle",6),I(8,Me,4,0,"ion-item",7)(9,Ie,4,0,"ion-item",7)(10,Se,4,0,"ion-item",7)(11,ke,4,0,"ion-item",7)(12,Oe,4,0,"ion-item",7)(13,Ve,4,0,"ion-item",7)(14,Te,4,0,"ion-item",7)(15,Ee,2,0,"ion-list-header",8)(16,Ue,4,0,"ion-item",7)(17,Le,4,0,"ion-item",7)(18,Re,4,0,"ion-item",7),a()(),r(19,"div",9),I(20,Ne,4,0,"ion-item",10),a(),r(21,"div",11)(22,"ion-item",12),f("click",function(){u(i);let t=p();return _(t.salir())}),m(23,"ion-icon",13),r(24,"ion-label"),c(25,"Cerrar sesi\xF3n"),a()()()()()}if(e&2){let i=p();s(8),l("ngIf",!i.isActive("/home")),s(),l("ngIf",!i.isActive("/solicitar")),s(),l("ngIf",!i.isActive("/votaciones")),s(),l("ngIf",!i.isActive("/inscripcion/proyectos")),s(),l("ngIf",!i.isActive("/solicitud")),s(),l("ngIf",!i.isActive("/espacios")),s(),l("ngIf",!i.isActive("/dashboard")),s(),l("ngIf",i.isAdmin),s(),l("ngIf",i.isAdmin&&!i.isActive("/generar/proyecto")),s(),l("ngIf",i.isAdmin&&!i.isActive("/generar/votacion")),s(),l("ngIf",i.isAdmin&&!i.isActive("/noticias/crear")),s(2),l("ngIf",!i.isActive("/perfil"))}}import("./chunk-M3E72E32.js");var R=(()=>{let n=class n{constructor(o,t,g,y,C){this.router=o,this.menu=t,this.auth=g,this.platform=y,this.ngZone=C,this.currentUrl="",this.isAdmin=!1,this.currentUrl=this.router.url||"",this.refrescarRol(),this.platform.ready().then(()=>w(this,null,function*(){yield this.configurarStatusBar(),n._deepLinkInit||(this.setupDeepLinks(),n._deepLinkInit=!0)})),this.router.events.pipe(j(h=>h instanceof $)).subscribe(h=>w(this,null,function*(){this.currentUrl=h.urlAfterRedirects||h.url||"",yield this.refrescarRol()}))}get isAuth(){return this.currentUrl.startsWith("/auth")}isActive(o){return this.currentUrl?this.currentUrl===o||this.currentUrl.startsWith(o+"/"):!1}go(o){return w(this,null,function*(){try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"),yield new Promise(t=>setTimeout(t,75)))}catch{}yield this.router.navigateByUrl(o,{replaceUrl:!1})})}salir(){return w(this,null,function*(){try{yield this.auth.signOut(),this.isAdmin=!1}finally{try{(yield this.menu.isOpen("mainMenu"))&&(yield this.menu.close("mainMenu"))}catch{}yield this.router.navigateByUrl("/auth/login",{replaceUrl:!0})}})}refrescarRol(){return w(this,null,function*(){try{if(this.isAuth){this.isAdmin=!1;return}let{data:{user:o}}=yield v.auth.getUser();if(!o){this.isAdmin=!1;return}let{data:t,error:g}=yield v.from("usuario").select("rol").eq("user_id",o.id).maybeSingle();if(g){this.isAdmin=!1;return}this.isAdmin=t?.rol==="administrador"}catch{this.isAdmin=!1}})}configurarStatusBar(){return w(this,null,function*(){try{yield V.setOverlaysWebView({overlay:!1}),yield V.setBackgroundColor({color:"#000000"}),yield V.setStyle({style:U.Dark})}catch{}})}setupDeepLinks(){L.getLaunchUrl().then(o=>{o?.url&&this.handleUrl(o.url)}),L.addListener("appUrlOpen",o=>{o?.url&&this.handleUrl(o.url)})}handleUrl(o){return w(this,null,function*(){try{let t=new URL(o);if(t.protocol==="redbarrio:"&&t.host==="app"&&t.pathname.startsWith("/pago-retorno")||t.protocol==="capacitor:"&&t.host==="localhost"&&t.pathname==="/pago-retorno"){let g=t.searchParams.get("token_ws")||"";try{yield ve.close()}catch{}this.ngZone.run(()=>{this.router.navigate(["/pago-retorno"],{queryParams:{token_ws:g},replaceUrl:!0})});return}if(t.protocol==="myapp:"&&t.host==="auth"){let g=t.searchParams,y=new URLSearchParams(t.hash?.startsWith("#")?t.hash.slice(1):t.hash),C=B=>g.get(B)??y.get(B),h=C("type"),x=C("access_token"),N=C("refresh_token"),D=C("code");h==="recovery"&&x&&N?yield v.auth.setSession({access_token:x,refresh_token:N}):D?yield v.auth.exchangeCodeForSession(D):console.warn("Deep link sin tokens ni code. No se pudo establecer sesi\xF3n."),this.ngZone.run(()=>{this.router.navigateByUrl("/auth/recuperar-contrasena",{replaceUrl:!0})});return}}catch(t){console.error("Deep link parse error",t)}})}};n._deepLinkInit=!1,n.\u0275fac=function(t){return new(t||n)(P(S),P(_e),P(we),P(Q),P(q))},n.\u0275cmp=W({type:n,selectors:[["app-root"]],decls:3,vars:1,consts:[["side","start","menuId","mainMenu","contentId","main-content","type","reveal",4,"ngIf"],["id","main-content"],["side","start","menuId","mainMenu","contentId","main-content","type","reveal"],[1,"menu-header"],[1,"menu-content"],["lines","none",1,"menu-list"],["auto-hide","true"],["button","","detail","false",3,"click",4,"ngIf"],[4,"ngIf"],[1,"perfil-wrap"],["button","","detail","false","class","perfil",3,"click",4,"ngIf"],[1,"logout-wrap"],["button","","detail","false",1,"logout",3,"click"],["slot","start","name","log-out-outline"],["button","","detail","false",3,"click"],["slot","start","name","home-outline"],["slot","start","name","document-text-outline"],["slot","start","name","people-outline"],["slot","start","name","calendar-outline"],["slot","start","name","business-outline"],["slot","start","name","construct-outline"],["slot","start","name","list-circle-outline"],["button","","detail","false",1,"perfil",3,"click"],["slot","start","name","person-circle-outline"]],template:function(t,g){t&1&&(r(0,"ion-app"),I(1,De,26,12,"ion-menu",0),m(2,"ion-router-outlet",1),a()),t&2&&(s(),l("ngIf",!g.isAuth))},dependencies:[Z,H,k,ee,te,ne,ie,oe,re,ae,ce,se,le,me,pe,ue],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{position:relative;z-index:1000;pointer-events:auto;--min-height: 56px}ion-menu[type=reveal][_ngcontent-%COMP%]::part(backdrop){opacity:0;pointer-events:none}ion-menu[_ngcontent-%COMP%]::part(container){box-shadow:0 8px 24px #0206173d;border-right:1px solid rgba(2,6,23,.06)}.menu-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #2563eb, #60a5fa);--color: #fff}.menu-content[_ngcontent-%COMP%]{--background: #f8fafc}.menu-content[_ngcontent-%COMP%]   .menu-list[_ngcontent-%COMP%]{background:transparent;padding:6px 0}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:8px 6px;border-radius:14px;background:#fff;--background: #fff;border:1px solid rgba(37,99,235,.1);transition:transform .12s ease,box-shadow .12s ease,border-color .12s ease}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#2563eb;font-size:20px}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:focus-within, .menu-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:hover{border-color:#2563eb33;box-shadow:0 8px 18px #2563eb1a}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]{margin-top:auto;padding-top:8px}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]{background:#fff5f5;border-color:#ef444433}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#ef4444}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#b91c1c}.menu-content[_ngcontent-%COMP%]   .logout-wrap[_ngcontent-%COMP%]   .logout[_ngcontent-%COMP%]:hover{box-shadow:0 8px 18px #ef44441f}']});let e=n;return e})();fe.register(ge,xe,he,Ce,de);var ye=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=M({type:n,bootstrap:[R]}),n.\u0275inj=A({providers:[{provide:K,useClass:X}],imports:[J,k.forRoot(),be,R]});let e=n;return e})();z().bootstrapModule(ye).catch(e=>console.log(e));
