import{Ab as Y,Cb as U,D as g,Gb as F,Hb as L,K as r,L as m,M as f,Pa as O,Ra as y,Sa as E,Ta as k,Va as S,Wa as w,Ya as j,Z as h,ab as z,ba as C,bb as A,fb as N,ha as P,ja as M,ka as I,ma as v,n,o as p,p as x,s as b,tb as T,v as d,w as i,wb as R,x as o,xb as J,y as _}from"./chunk-LBATYOJ7.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as u}from"./chunk-VI73JOY6.js";function H(a,c){if(a&1&&(i(0,"div",4),_(1,"ion-spinner",5),i(2,"p",6),r(3),o()()),a&2){let t=g();n(3),m(t.mensaje)}}function B(a,c){if(a&1&&(i(0,"ion-card-content")(1,"div",11)(2,"ion-chip",12),_(3,"ion-icon",13),i(4,"ion-label"),r(5),o()()(),i(6,"div",14)(7,"p")(8,"strong"),r(9,"Monto:"),o(),r(10),o(),i(11,"p")(12,"strong"),r(13,"Tipo de pago:"),o(),r(14),o(),i(15,"p")(16,"strong"),r(17,"C\xF3digo autorizaci\xF3n:"),o(),r(18),o()()()),a&2){let t=g(2);n(2),d("color",(t.detalles==null?null:t.detalles.estado)==="Pagado"?"success":"danger"),n(),d("name",(t.detalles==null?null:t.detalles.estado)==="Pagado"?"checkmark-circle":"close-circle"),n(2),m(t.detalles.estado),n(5),f(" $",t.detalles.monto),n(4),f(" ",t.detalles.tipoPago),n(4),f(" ",t.detalles.codigoAutorizacion)}}function D(a,c){if(a&1&&(i(0,"div",7)(1,"ion-card",8)(2,"ion-card-header")(3,"ion-card-title"),r(4),o()(),b(5,B,19,6,"ion-card-content",9),o(),i(6,"ion-button",10),r(7," Volver al inicio "),o()()),a&2){let t=g();n(),d("color",(t.detalles==null?null:t.detalles.estado)==="Pagado"?"success":"danger"),n(3),m(t.mensaje),n(),d("ngIf",t.detalles)}}var V="https://sovnabbbubapqxziubuh.supabase.co",Z="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvdm5hYmJidWJhcHF4eml1YnVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NTY0NzcsImV4cCI6MjA3NDMzMjQ3N30.eQoxa8NkXwHwpSM03bB2gEJj9EZ0FxK3-nY3SJe5iiE",X=L(V,Z),oe=(()=>{let c=class c{constructor(s,e,l){this.route=s,this.router=e,this.alertCtrl=l,this.mensaje="Procesando pago...",this.detalles=null,this.loading=!0}ngOnInit(){return u(this,null,function*(){yield this.confirmarPago()})}confirmarPago(){return u(this,null,function*(){let s=this.route.snapshot.queryParamMap.get("token_ws");if(!s){this.mensaje="\u26A0\uFE0F No se encontr\xF3 el token del pago.",this.loading=!1;return}try{let{data:e,error:l}=yield X.functions.invoke("transbank-confirm",{body:{token_ws:s}});if(this.loading=!1,l){console.error("Error Supabase:",l),this.mensaje="\u274C Error al confirmar el pago.";return}e?.status==="AUTHORIZED"?(this.mensaje="\u2705 Pago realizado con \xE9xito.",this.detalles={estado:"Pagado",codigoAutorizacion:e.authorization_code,tipoPago:e.payment_type_code,monto:e.amount}):(this.mensaje="\u274C El pago fue rechazado o no autorizado.",this.detalles={estado:"Rechazado",codigoAutorizacion:e?.authorization_code??"N/A",tipoPago:e?.payment_type_code??"N/A",monto:e?.amount??0}),yield(yield this.alertCtrl.create({header:"Resultado del Pago",message:this.mensaje,buttons:[{text:"Volver al inicio",handler:()=>this.router.navigate(["/home"])}]})).present()}catch(e){console.error("Error general:",e),this.loading=!1,this.mensaje="\u26A0\uFE0F Error inesperado al confirmar el pago."}})}};c.\u0275fac=function(e){return new(e||c)(p(P),p(M),p(U))},c.\u0275cmp=x({type:c,selectors:[["app-pago-retorno"]],decls:7,vars:3,consts:[[1,"rb-header"],[1,"ion-padding","webpay",3,"fullscreen"],["class","loading-box fade-in",4,"ngIf"],["class","fade-in",4,"ngIf"],[1,"loading-box","fade-in"],["name","crescent",1,"spinner"],[1,"ion-margin-top"],[1,"fade-in"],[1,"card","pop-in",3,"color"],[4,"ngIf"],["expand","block","color","medium","routerLink","/home",1,"slide-up"],[1,"status-row"],["outline","true",3,"color"],[3,"name"],[1,"kv"]],template:function(e,l){e&1&&(i(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),r(3,"Pago WebPay"),o()()(),i(4,"ion-content",1),b(5,H,4,1,"div",2)(6,D,8,3,"div",3),o()),e&2&&(n(4),d("fullscreen",!0),n(),d("ngIf",l.loading),n(),d("ngIf",!l.loading))},dependencies:[C,h,F,O,y,E,k,S,w,j,z,A,N,T,R,J,Y,v,I],styles:['@charset "UTF-8";[_nghost-%COMP%]{color-scheme:light;--rb-primary: #2563eb;--rb-primary-10: rgba(37, 99, 235, .1);--rb-primary-20: rgba(37, 99, 235, .2);--rb-bg: #f8fafc;--rb-text: #0f172a;--ion-background-color: var(--rb-bg);--ion-text-color: var(--rb-text)}.rb-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: linear-gradient(135deg, var(--rb-primary), #60a5fa);--color: #fff;--border-color: transparent}.webpay[_ngcontent-%COMP%]{text-align:center}.webpay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--rb-text)}ion-card.card[_ngcontent-%COMP%]{background:#fff!important;border-radius:18px;border:1px solid rgba(2,6,23,.06);box-shadow:0 10px 26px #02061714;overflow:hidden;text-align:left}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid rgba(2,6,23,.06)}ion-card.card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-weight:800;color:var(--rb-text)}ion-card.card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:12px}ion-card.card[color=success][_ngcontent-%COMP%]{border-left:6px solid #16a34a}ion-card.card[color=danger][_ngcontent-%COMP%]{border-left:6px solid #ef4444}.status-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:10px}.status-row[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{--background: var(--rb-primary-10);--color: var(--rb-text);--border-color: var(--rb-primary-20)}.kv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0}.kv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#334155}.loading-box[_ngcontent-%COMP%]{display:grid;place-items:center;gap:.5rem;min-height:35vh}.spinner[_ngcontent-%COMP%]{filter:drop-shadow(0 6px 16px rgba(37,99,235,.25))}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_popIn{0%{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .28s ease-out both}.pop-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_popIn .22s ease-out both}.slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideUp .25s ease-out .05s both}ion-button[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 10px 18px var(--rb-primary-10);--padding-start: 14px;--padding-end: 14px}.md[_ngcontent-%COMP%]   ion-card.card[_ngcontent-%COMP%]{text-align:left}.ios[_ngcontent-%COMP%]   ion-card.card[_ngcontent-%COMP%]{text-align:left}']});let a=c;return a})();export{oe as PagoRetornoPage};
