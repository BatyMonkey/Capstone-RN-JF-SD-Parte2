import{a as he,c as q,h as ht}from"./chunk-5NLYO5NP.js";import{a as K}from"./chunk-MLOBWV3E.js";import"./chunk-66QFWZLQ.js";import{$ as kt,$a as te,C as ct,E as Dt,Ea as qt,F as Bt,G as Rt,Gb as xe,Ja as Kt,K as m,L as E,M as et,N as xt,O as Ft,P as Gt,Q as Nt,Qa as Vt,Ra as $t,Sa as Jt,Ta as Qt,U as D,V as B,Va as Xt,Xa as Zt,Y as zt,Ya as Yt,_ as Lt,a as It,ab as ee,ba as Wt,bb as re,d as Tt,e as tt,eb as oe,fb as ae,g as wt,gb as ie,jb as ne,k as St,l as jt,lb as se,mb as fe,n as h,nb as pe,o as A,oa as Ht,ob as le,p as Mt,pb as de,qb as me,r as At,s as Pt,t as ut,ta as Ut,u as Et,v as P,w as p,wb as ue,x as d,xb as ce,y as I}from"./chunk-LBATYOJ7.js";import"./chunk-G4GOZ2R2.js";import"./chunk-2GHFZAQB.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VBARJE22.js";import"./chunk-6T3MRKSY.js";import"./chunk-LG5HFCS7.js";import"./chunk-PTM2QU7L.js";import"./chunk-Z7QLWI7J.js";import"./chunk-DNXVUVY2.js";import"./chunk-JS56SECH.js";import"./chunk-GFYYGWWH.js";import"./chunk-EXVGCGBZ.js";import"./chunk-IACAUHTZ.js";import"./chunk-WIVIOYVM.js";import"./chunk-ULQSOQCK.js";import"./chunk-JOPIHTUJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-EKNMT7ZB.js";import"./chunk-CKP3SGE2.js";import"./chunk-K6CL52MX.js";import{j as C}from"./chunk-VI73JOY6.js";var Hr=typeof global=="object"&&global&&global.Object===Object&&global,rt=Hr;var Ur=typeof self=="object"&&self&&self.Object===Object&&self,qr=rt||Ur||Function("return this")(),y=qr;var Kr=y.Symbol,R=Kr;var ge=Object.prototype,Vr=ge.hasOwnProperty,$r=ge.toString,V=R?R.toStringTag:void 0;function Jr(t){var e=Vr.call(t,V),r=t[V];try{t[V]=void 0;var o=!0}catch{}var a=$r.call(t);return o&&(e?t[V]=r:delete t[V]),a}var be=Jr;var Qr=Object.prototype,Xr=Qr.toString;function Zr(t){return Xr.call(t)}var ye=Zr;var Yr="[object Null]",to="[object Undefined]",ve=R?R.toStringTag:void 0;function eo(t){return t==null?t===void 0?to:Yr:ve&&ve in Object(t)?be(t):ye(t)}var T=eo;function ro(t){return t!=null&&typeof t=="object"}var v=ro;var oo=Array.isArray,$=oo;function ao(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var b=ao;function io(t){return t}var ot=io;var no="[object AsyncFunction]",so="[object Function]",fo="[object GeneratorFunction]",po="[object Proxy]";function lo(t){if(!b(t))return!1;var e=T(t);return e==so||e==fo||e==no||e==po}var F=lo;var mo=y["__core-js_shared__"],at=mo;var Ce=(function(){var t=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function uo(t){return!!Ce&&Ce in t}var _e=uo;var co=Function.prototype,xo=co.toString;function ho(t){if(t!=null){try{return xo.call(t)}catch{}try{return t+""}catch{}}return""}var Oe=ho;var go=/[\\^$.*+?()[\]{}|]/g,bo=/^\[object .+?Constructor\]$/,yo=Function.prototype,vo=Object.prototype,Co=yo.toString,_o=vo.hasOwnProperty,Oo=RegExp("^"+Co.call(_o).replace(go,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Io(t){if(!b(t)||_e(t))return!1;var e=F(t)?Oo:bo;return e.test(Oe(t))}var Ie=Io;function To(t,e){return t?.[e]}var Te=To;function wo(t,e){var r=Te(t,e);return Ie(r)?r:void 0}var G=wo;var we=Object.create,So=(function(){function t(){}return function(e){if(!b(e))return{};if(we)return we(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})(),Se=So;function jo(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var je=jo;function Mo(t,e){var r=-1,o=t.length;for(e||(e=Array(o));++r<o;)e[r]=t[r];return e}var Me=Mo;var Ao=800,Po=16,Eo=Date.now;function Do(t){var e=0,r=0;return function(){var o=Eo(),a=Po-(o-r);if(r=o,a>0){if(++e>=Ao)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Ae=Do;function Bo(t){return function(){return t}}var Pe=Bo;var Ro=(function(){try{var t=G(Object,"defineProperty");return t({},"",{}),t}catch{}})(),N=Ro;var Fo=N?function(t,e){return N(t,"toString",{configurable:!0,enumerable:!1,value:Pe(e),writable:!0})}:ot,Ee=Fo;var Go=Ae(Ee),De=Go;var No=9007199254740991,zo=/^(?:0|[1-9]\d*)$/;function Lo(t,e){var r=typeof t;return e=e??No,!!e&&(r=="number"||r!="symbol"&&zo.test(t))&&t>-1&&t%1==0&&t<e}var it=Lo;function ko(t,e,r){e=="__proto__"&&N?N(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var z=ko;function Wo(t,e){return t===e||t!==t&&e!==e}var w=Wo;var Ho=Object.prototype,Uo=Ho.hasOwnProperty;function qo(t,e,r){var o=t[e];(!(Uo.call(t,e)&&w(o,r))||r===void 0&&!(e in t))&&z(t,e,r)}var Be=qo;function Ko(t,e,r,o){var a=!r;r||(r={});for(var i=-1,n=e.length;++i<n;){var s=e[i],l=o?o(r[s],t[s],s,r,t):void 0;l===void 0&&(l=t[s]),a?z(r,s,l):Be(r,s,l)}return r}var Re=Ko;var Fe=Math.max;function Vo(t,e,r){return e=Fe(e===void 0?t.length-1:e,0),function(){for(var o=arguments,a=-1,i=Fe(o.length-e,0),n=Array(i);++a<i;)n[a]=o[e+a];a=-1;for(var s=Array(e+1);++a<e;)s[a]=o[a];return s[e]=r(n),je(t,this,s)}}var Ge=Vo;function $o(t,e){return De(Ge(t,e,ot),t+"")}var Ne=$o;var Jo=9007199254740991;function Qo(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Jo}var nt=Qo;function Xo(t){return t!=null&&nt(t.length)&&!F(t)}var L=Xo;function Zo(t,e,r){if(!b(r))return!1;var o=typeof e;return(o=="number"?L(r)&&it(e,r.length):o=="string"&&e in r)?w(r[e],t):!1}var ze=Zo;function Yo(t){return Ne(function(e,r){var o=-1,a=r.length,i=a>1?r[a-1]:void 0,n=a>2?r[2]:void 0;for(i=t.length>3&&typeof i=="function"?(a--,i):void 0,n&&ze(r[0],r[1],n)&&(i=a<3?void 0:i,a=1),e=Object(e);++o<a;){var s=r[o];s&&t(e,s,o,i)}return e})}var Le=Yo;var ta=Object.prototype;function ea(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ta;return t===r}var st=ea;function ra(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}var ke=ra;var oa="[object Arguments]";function aa(t){return v(t)&&T(t)==oa}var gt=aa;var We=Object.prototype,ia=We.hasOwnProperty,na=We.propertyIsEnumerable,sa=gt((function(){return arguments})())?gt:function(t){return v(t)&&ia.call(t,"callee")&&!na.call(t,"callee")},J=sa;function fa(){return!1}var He=fa;var Ke=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ue=Ke&&typeof module=="object"&&module&&!module.nodeType&&module,pa=Ue&&Ue.exports===Ke,qe=pa?y.Buffer:void 0,la=qe?qe.isBuffer:void 0,da=la||He,ft=da;var ma="[object Arguments]",ua="[object Array]",ca="[object Boolean]",xa="[object Date]",ha="[object Error]",ga="[object Function]",ba="[object Map]",ya="[object Number]",va="[object Object]",Ca="[object RegExp]",_a="[object Set]",Oa="[object String]",Ia="[object WeakMap]",Ta="[object ArrayBuffer]",wa="[object DataView]",Sa="[object Float32Array]",ja="[object Float64Array]",Ma="[object Int8Array]",Aa="[object Int16Array]",Pa="[object Int32Array]",Ea="[object Uint8Array]",Da="[object Uint8ClampedArray]",Ba="[object Uint16Array]",Ra="[object Uint32Array]",u={};u[Sa]=u[ja]=u[Ma]=u[Aa]=u[Pa]=u[Ea]=u[Da]=u[Ba]=u[Ra]=!0;u[ma]=u[ua]=u[Ta]=u[ca]=u[wa]=u[xa]=u[ha]=u[ga]=u[ba]=u[ya]=u[va]=u[Ca]=u[_a]=u[Oa]=u[Ia]=!1;function Fa(t){return v(t)&&nt(t.length)&&!!u[T(t)]}var Ve=Fa;function Ga(t){return function(e){return t(e)}}var $e=Ga;var Je=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Q=Je&&typeof module=="object"&&module&&!module.nodeType&&module,Na=Q&&Q.exports===Je,bt=Na&&rt.process,za=(function(){try{var t=Q&&Q.require&&Q.require("util").types;return t||bt&&bt.binding&&bt.binding("util")}catch{}})(),yt=za;var Qe=yt&&yt.isTypedArray,La=Qe?$e(Qe):Ve,pt=La;var ka=Object.prototype,Wa=ka.hasOwnProperty;function Ha(t,e){var r=$(t),o=!r&&J(t),a=!r&&!o&&ft(t),i=!r&&!o&&!a&&pt(t),n=r||o||a||i,s=n?ke(t.length,String):[],l=s.length;for(var g in t)(e||Wa.call(t,g))&&!(n&&(g=="length"||a&&(g=="offset"||g=="parent")||i&&(g=="buffer"||g=="byteLength"||g=="byteOffset")||it(g,l)))&&s.push(g);return s}var Xe=Ha;function Ua(t,e){return function(r){return t(e(r))}}var Ze=Ua;function qa(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Ye=qa;var Ka=Object.prototype,Va=Ka.hasOwnProperty;function $a(t){if(!b(t))return Ye(t);var e=st(t),r=[];for(var o in t)o=="constructor"&&(e||!Va.call(t,o))||r.push(o);return r}var tr=$a;function Ja(t){return L(t)?Xe(t,!0):tr(t)}var lt=Ja;var Qa=G(Object,"create"),_=Qa;function Xa(){this.__data__=_?_(null):{},this.size=0}var er=Xa;function Za(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var rr=Za;var Ya="__lodash_hash_undefined__",ti=Object.prototype,ei=ti.hasOwnProperty;function ri(t){var e=this.__data__;if(_){var r=e[t];return r===Ya?void 0:r}return ei.call(e,t)?e[t]:void 0}var or=ri;var oi=Object.prototype,ai=oi.hasOwnProperty;function ii(t){var e=this.__data__;return _?e[t]!==void 0:ai.call(e,t)}var ar=ii;var ni="__lodash_hash_undefined__";function si(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=_&&e===void 0?ni:e,this}var ir=si;function k(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}k.prototype.clear=er;k.prototype.delete=rr;k.prototype.get=or;k.prototype.has=ar;k.prototype.set=ir;var vt=k;function fi(){this.__data__=[],this.size=0}var nr=fi;function pi(t,e){for(var r=t.length;r--;)if(w(t[r][0],e))return r;return-1}var S=pi;var li=Array.prototype,di=li.splice;function mi(t){var e=this.__data__,r=S(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():di.call(e,r,1),--this.size,!0}var sr=mi;function ui(t){var e=this.__data__,r=S(e,t);return r<0?void 0:e[r][1]}var fr=ui;function ci(t){return S(this.__data__,t)>-1}var pr=ci;function xi(t,e){var r=this.__data__,o=S(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}var lr=xi;function W(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}W.prototype.clear=nr;W.prototype.delete=sr;W.prototype.get=fr;W.prototype.has=pr;W.prototype.set=lr;var j=W;var hi=G(y,"Map"),dt=hi;function gi(){this.size=0,this.__data__={hash:new vt,map:new(dt||j),string:new vt}}var dr=gi;function bi(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var mr=bi;function yi(t,e){var r=t.__data__;return mr(e)?r[typeof e=="string"?"string":"hash"]:r.map}var M=yi;function vi(t){var e=M(this,t).delete(t);return this.size-=e?1:0,e}var ur=vi;function Ci(t){return M(this,t).get(t)}var cr=Ci;function _i(t){return M(this,t).has(t)}var xr=_i;function Oi(t,e){var r=M(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}var hr=Oi;function H(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}H.prototype.clear=dr;H.prototype.delete=ur;H.prototype.get=cr;H.prototype.has=xr;H.prototype.set=hr;var gr=H;var Ii=Ze(Object.getPrototypeOf,Object),mt=Ii;var Ti="[object Object]",wi=Function.prototype,Si=Object.prototype,br=wi.toString,ji=Si.hasOwnProperty,Mi=br.call(Object);function Ai(t){if(!v(t)||T(t)!=Ti)return!1;var e=mt(t);if(e===null)return!0;var r=ji.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&br.call(r)==Mi}var yr=Ai;function Pi(){this.__data__=new j,this.size=0}var vr=Pi;function Ei(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Cr=Ei;function Di(t){return this.__data__.get(t)}var _r=Di;function Bi(t){return this.__data__.has(t)}var Or=Bi;var Ri=200;function Fi(t,e){var r=this.__data__;if(r instanceof j){var o=r.__data__;if(!dt||o.length<Ri-1)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new gr(o)}return r.set(t,e),this.size=r.size,this}var Ir=Fi;function U(t){var e=this.__data__=new j(t);this.size=e.size}U.prototype.clear=vr;U.prototype.delete=Cr;U.prototype.get=_r;U.prototype.has=Or;U.prototype.set=Ir;var Tr=U;var Mr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wr=Mr&&typeof module=="object"&&module&&!module.nodeType&&module,Gi=wr&&wr.exports===Mr,Sr=Gi?y.Buffer:void 0,jr=Sr?Sr.allocUnsafe:void 0;function Ni(t,e){if(e)return t.slice();var r=t.length,o=jr?jr(r):new t.constructor(r);return t.copy(o),o}var Ar=Ni;var zi=y.Uint8Array,Ct=zi;function Li(t){var e=new t.constructor(t.byteLength);return new Ct(e).set(new Ct(t)),e}var Pr=Li;function ki(t,e){var r=e?Pr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Er=ki;function Wi(t){return typeof t.constructor=="function"&&!st(t)?Se(mt(t)):{}}var Dr=Wi;function Hi(t){return function(e,r,o){for(var a=-1,i=Object(e),n=o(e),s=n.length;s--;){var l=n[t?s:++a];if(r(i[l],l,i)===!1)break}return e}}var Br=Hi;var Ui=Br(),Rr=Ui;function qi(t,e,r){(r!==void 0&&!w(t[e],r)||r===void 0&&!(e in t))&&z(t,e,r)}var X=qi;function Ki(t){return v(t)&&L(t)}var Fr=Ki;function Vi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Z=Vi;function $i(t){return Re(t,lt(t))}var Gr=$i;function Ji(t,e,r,o,a,i,n){var s=Z(t,r),l=Z(e,r),g=n.get(l);if(g){X(t,r,g);return}var x=i?i(s,l,r+"",t,e,n):void 0,O=x===void 0;if(O){var f=$(l),c=!f&&ft(l),Y=!f&&!c&&pt(l);x=l,f||c||Y?$(s)?x=s:Fr(s)?x=Me(s):c?(O=!1,x=Ar(l,!0)):Y?(O=!1,x=Er(l,!0)):x=[]:yr(l)||J(l)?(x=s,J(s)?x=Gr(s):(!b(s)||F(s))&&(x=Dr(l))):O=!1}O&&(n.set(l,x),a(x,l,o,i,n),n.delete(l)),X(t,r,x)}var Nr=Ji;function zr(t,e,r,o,a){t!==e&&Rr(e,function(i,n){if(a||(a=new Tr),b(i))Nr(t,e,n,r,zr,o,a);else{var s=o?o(Z(t,n),i,n+"",t,e,a):void 0;s===void 0&&(s=i),X(t,n,s)}},lt)}var Lr=zr;var Qi=Le(function(t,e,r){Lr(t,e,r)}),_t=Qi;var Xi=new wt("Configuration for ngCharts");var Zi=(()=>{let e=class e{constructor(){this.colorschemesOptions=new It(void 0)}setColorschemesOptions(o){this.pColorschemesOptions=o,this.colorschemesOptions.next(o)}getColorschemesOptions(){return this.pColorschemesOptions}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=tt({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),Ot=(()=>{let e=class e{constructor(o,a,i,n){this.zone=a,this.themeService=i,this.type="bar",this.plugins=[],this.chartClick=new ut,this.chartHover=new ut,this.subs=[],this.themeOverrides={},n?.registerables&&q.register(...n.registerables),n?.defaults&&he.set(n.defaults),this.ctx=o.nativeElement.getContext("2d"),this.subs.push(this.themeService.colorschemesOptions.pipe(Tt()).subscribe(s=>this.themeChanged(s)))}ngOnChanges(o){let a=["type"],i=Object.getOwnPropertyNames(o);if(i.some(n=>a.includes(n))||i.every(n=>o[n].isFirstChange()))this.render();else{let n=this.getChartConfiguration();this.chart&&(Object.assign(this.chart.config.data,n.data),this.chart.config.plugins&&Object.assign(this.chart.config.plugins,n.plugins),this.chart.config.options&&Object.assign(this.chart.config.options,n.options)),this.update()}}ngOnDestroy(){this.chart&&(this.chart.destroy(),this.chart=void 0),this.subs.forEach(o=>o.unsubscribe())}render(){return this.chart&&this.chart.destroy(),this.zone.runOutsideAngular(()=>this.chart=new q(this.ctx,this.getChartConfiguration()))}update(o){this.chart&&this.zone.runOutsideAngular(()=>this.chart?.update(o))}hideDataset(o,a){this.chart&&(this.chart.getDatasetMeta(o).hidden=a,this.update())}isDatasetHidden(o){return this.chart?.getDatasetMeta(o)?.hidden}toBase64Image(){return this.chart?.toBase64Image()}themeChanged(o){this.themeOverrides=o,this.chart&&(this.chart.config.options&&Object.assign(this.chart.config.options,this.getChartOptions()),this.update())}getChartOptions(){return _t({onHover:(o,a)=>{!this.chartHover.observed&&!this.chartHover.observers?.length||this.zone.run(()=>this.chartHover.emit({event:o,active:a}))},onClick:(o,a)=>{!this.chartClick.observed&&!this.chartClick.observers?.length||this.zone.run(()=>this.chartClick.emit({event:o,active:a}))}},this.themeOverrides,this.options,{plugins:{legend:{display:this.legend}}})}getChartConfiguration(){return{type:this.type,data:this.getChartData(),options:this.getChartOptions(),plugins:this.plugins}}getChartData(){return this.data?this.data:{labels:this.labels||[],datasets:this.datasets||[]}}};e.\u0275fac=function(a){return new(a||e)(A(jt),A(Et),A(Zi),A(Xi,8))},e.\u0275dir=At({type:e,selectors:[["canvas","baseChart",""]],inputs:{type:"type",legend:"legend",data:"data",options:"options",plugins:"plugins",labels:"labels",datasets:"datasets"},outputs:{chartClick:"chartClick",chartHover:"chartHover"},exportAs:["base-chart"],features:[St]});let t=e;return t})();var Wr=(()=>{let e=class e{constructor(){}getMetricas(){return C(this,null,function*(){let{data:o,error:a}=yield K.from("metricas_vecinales").select("*").order("fecha",{ascending:!1});return{data:o,error:a}})}getTotales(){return C(this,null,function*(){let{data:o,error:a}=yield K.from("metricas_vecinales").select("tipo_transaccion, monto");if(a||!o)return{error:a};let i=o.filter(s=>s.tipo_transaccion==="Ingreso").reduce((s,l)=>s+Number(l.monto),0),n=o.filter(s=>s.tipo_transaccion==="Gasto").reduce((s,l)=>s+Number(l.monto),0);return{ingresos:i,gastos:n,balance:i-n}})}getTotalCertificados(){return C(this,null,function*(){let{count:o,error:a}=yield K.from("certificados").select("*",{count:"exact",head:!0});return{totalCertificados:o||0,error:a}})}getTotalReservas(){return C(this,null,function*(){let{count:o,error:a}=yield K.from("reserva").select("*",{count:"exact",head:!0});return{totalReservas:o||0,error:a}})}};e.\u0275fac=function(a){return new(a||e)},e.\u0275prov=tt({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function tn(t,e){if(t&1&&(p(0,"ion-item")(1,"ion-label")(2,"h2"),m(3),d(),p(4,"p"),m(5),d(),p(6,"p"),m(7),D(8,"date"),d()(),p(9,"ion-note",25),m(10),D(11,"number"),d()()),t&2){let r=e.$implicit;h(3),E(r.nombre_item),h(2),xt("",r.categoria," \u2014 ",r.tipo_fondo),h(2),E(B(8,7,r.fecha,"dd/MM/yyyy")),h(2),P("color",r.tipo_transaccion==="Ingreso"?"success":"danger"),h(),xt(" ",r.tipo_transaccion==="Ingreso"?"+":"-","$",B(11,10,r.monto,"1.0-0")," ")}}q.register(...ht);var id=(()=>{let e=class e{constructor(o){this.metricasService=o,this.metricas=[],this.metricasOriginales=[],this.totalIngresos=0,this.totalGastos=0,this.balance=0,this.totalCertificados=0,this.totalReservas=0,this.cargando=!0,this.errorMsg="",this.filtroTipo="Todos",this.chartDataCategoria={labels:[],datasets:[{data:[]}]},this.chartDataIngresosGastos={labels:[],datasets:[]},this.chartDataTopCategorias={labels:[],datasets:[]},this.tituloTopCategorias="Top Categor\xEDas"}ngOnInit(){return C(this,null,function*(){yield this.cargarMetricas(),yield this.cargarKpis()})}cargarMetricas(){return C(this,null,function*(){this.cargando=!0;let{data:o,error:a}=yield this.metricasService.getMetricas();a?(this.errorMsg="Error al cargar las m\xE9tricas.",console.error(a)):(this.metricasOriginales=o||[],this.aplicarFiltro()),this.cargando=!1})}cargarKpis(){return C(this,null,function*(){try{let{totalCertificados:o,error:a}=yield this.metricasService.getTotalCertificados(),{totalReservas:i,error:n}=yield this.metricasService.getTotalReservas();a||(this.totalCertificados=o),n||(this.totalReservas=i)}catch(o){console.error("Error al cargar KPIs:",o)}})}filtrarPorTipo(o){this.filtroTipo=o,this.aplicarFiltro()}aplicarFiltro(){this.metricas=this.filtroTipo==="Todos"?[...this.metricasOriginales]:this.metricasOriginales.filter(o=>o.tipo_transaccion===this.filtroTipo),this.calcularTotales(),this.actualizarGraficos()}calcularTotales(){let o=this.metricas.filter(i=>i.tipo_transaccion==="Ingreso"),a=this.metricas.filter(i=>i.tipo_transaccion==="Gasto");this.totalIngresos=o.reduce((i,n)=>i+Number(n.monto||0),0),this.totalGastos=a.reduce((i,n)=>i+Number(n.monto||0),0),this.balance=this.totalIngresos-this.totalGastos}actualizarGraficos(){let o=new Map;this.metricas.forEach(f=>{let c=o.get(f.categoria)||0;o.set(f.categoria,c+Number(f.monto))});let a=Array.from(o.entries()),i=a.reduce((f,[,c])=>f+c,0),n=a.map(([f,c])=>{let Y=i?c/i*100:0;return`${f} (${Y.toFixed(1)}%)`});this.chartDataCategoria={labels:n,datasets:[{data:a.map(([f,c])=>c),backgroundColor:["#2563eb","#16a34a","#f59e0b","#ef4444","#8b5cf6","#0ea5e9","#14b8a6","#f97316","#84cc16"]}]};let s=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],l=new Array(12).fill(0),g=new Array(12).fill(0);this.metricas.forEach(f=>{let c=new Date(f.fecha).getMonth();f.tipo_transaccion==="Ingreso"?l[c]+=Number(f.monto):f.tipo_transaccion==="Gasto"&&(g[c]+=Number(f.monto))}),this.chartDataIngresosGastos={labels:s,datasets:[{label:"Ingresos",data:l,backgroundColor:"#16a34a"},{label:"Gastos",data:g,backgroundColor:"#ef4444"}]};let x=new Map;this.filtroTipo==="Ingreso"?(this.metricas.filter(f=>f.tipo_transaccion==="Ingreso").forEach(f=>{let c=x.get(f.categoria)||0;x.set(f.categoria,c+Number(f.monto))}),this.tituloTopCategorias="Top Categor\xEDas de Ingreso"):this.filtroTipo==="Gasto"?(this.metricas.filter(f=>f.tipo_transaccion==="Gasto").forEach(f=>{let c=x.get(f.categoria)||0;x.set(f.categoria,c+Number(f.monto))}),this.tituloTopCategorias="Top Categor\xEDas de Gasto"):(this.metricas.forEach(f=>{let c=x.get(f.categoria)||0;x.set(f.categoria,c+Number(f.monto))}),this.tituloTopCategorias="Top Categor\xEDas (Ingresos + Gastos)");let O=Array.from(x.entries()).sort((f,c)=>c[1]-f[1]).slice(0,5);this.chartDataTopCategorias={labels:O.map(([f])=>f),datasets:[{label:"Monto total",data:O.map(([f,c])=>c),backgroundColor:this.filtroTipo==="Gasto"?["#ef4444","#f97316","#f59e0b","#84cc16","#3b82f6"]:this.filtroTipo==="Ingreso"?["#16a34a","#22c55e","#84cc16","#3b82f6","#14b8a6"]:["#8b5cf6","#6366f1","#14b8a6","#22d3ee","#84cc16"]}]},this.chart?.update()}};e.\u0275fac=function(a){return new(a||e)(A(Wr))},e.\u0275cmp=Mt({type:e,selectors:[["app-dashboard"]],viewQuery:function(a,i){if(a&1&&Dt(Ot,5),a&2){let n;Bt(n=Rt())&&(i.chart=n.first)}},decls:89,vars:24,consts:[[1,"rb-header",3,"translucent"],["slot","start"],["menu","mainMenu","autoHide","false"],["fullscreen",""],["slot","fixed","pullMin","80","pullMax","150",3,"ionRefresh"],[1,"dashboard-wrapper"],[1,"dashboard-segment",3,"ngModelChange","ionChange","ngModel"],["value","Todos"],["value","Ingreso"],["value","Gasto"],[1,"dashboard-card"],["lines","none"],["color","success"],["color","danger"],["color","medium"],[1,"dashboard-card","kpi-card"],["size","6"],["name","document-text-outline","color","primary","slot","start"],["color","primary","slot","end"],["name","home-outline","color","tertiary","slot","start"],["color","tertiary","slot","end"],[1,"dashboard-chart-container"],["baseChart","",3,"data","type"],[1,"dashboard-card","movimientos-card"],[4,"ngFor","ngForOf"],["slot","end",3,"color"]],template:function(a,i){a&1&&(p(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),I(3,"ion-menu-button",2),d(),p(4,"ion-title"),m(5,"Dashboard Vecinal"),d()()(),p(6,"ion-content",3)(7,"ion-refresher",4),ct("ionRefresh",function(){return i.cargarMetricas()}),I(8,"ion-refresher-content"),d(),p(9,"div",5)(10,"ion-segment",6),Nt("ngModelChange",function(s){return Gt(i.filtroTipo,s)||(i.filtroTipo=s),s}),ct("ionChange",function(){return i.filtrarPorTipo(i.filtroTipo)}),p(11,"ion-segment-button",7),m(12,"Todos"),d(),p(13,"ion-segment-button",8),m(14,"Ingresos"),d(),p(15,"ion-segment-button",9),m(16,"Gastos"),d()(),p(17,"ion-card",10)(18,"ion-card-header")(19,"ion-card-title"),m(20,"Resumen Financiero"),d()(),p(21,"ion-card-content")(22,"ion-item",11)(23,"ion-label"),m(24,"\u{1F4B0} Ingresos"),d(),p(25,"ion-note",12),m(26),D(27,"number"),d()(),p(28,"ion-item",11)(29,"ion-label"),m(30,"\u{1F4B8} Gastos"),d(),p(31,"ion-note",13),m(32),D(33,"number"),d()(),p(34,"ion-item",11)(35,"ion-label"),m(36,"\u{1F4CA} Balance"),d(),p(37,"ion-note",14),m(38),D(39,"number"),d()()()(),p(40,"ion-card",15)(41,"ion-card-header")(42,"ion-card-title"),m(43,"Indicadores Generales"),d()(),p(44,"ion-card-content")(45,"ion-grid")(46,"ion-row")(47,"ion-col",16)(48,"ion-item",11),I(49,"ion-icon",17),p(50,"ion-label"),m(51,"Certificados"),d(),p(52,"ion-note",18),m(53),d()()(),p(54,"ion-col",16)(55,"ion-item",11),I(56,"ion-icon",19),p(57,"ion-label"),m(58,"Reservas"),d(),p(59,"ion-note",20),m(60),d()()()()()()(),p(61,"ion-card",10)(62,"ion-card-header")(63,"ion-card-title"),m(64,"Distribuci\xF3n por Categor\xEDa"),d()(),p(65,"ion-card-content")(66,"div",21),I(67,"canvas",22),d()()(),p(68,"ion-card",10)(69,"ion-card-header")(70,"ion-card-title"),m(71,"Ingresos vs Gastos (Mensual)"),d()(),p(72,"ion-card-content")(73,"div",21),I(74,"canvas",22),d()()(),p(75,"ion-card",10)(76,"ion-card-header")(77,"ion-card-title"),m(78),d()(),p(79,"ion-card-content")(80,"div",21),I(81,"canvas",22),d()()(),p(82,"ion-card",23)(83,"ion-card-header")(84,"ion-card-title"),m(85,"Movimientos recientes"),d()(),p(86,"ion-card-content")(87,"ion-list",11),Pt(88,tn,12,13,"ion-item",24),d()()()()()),a&2&&(P("translucent",!0),h(10),Ft("ngModel",i.filtroTipo),h(16),et("$",B(27,15,i.totalIngresos,"1.0-0")),h(6),et("$",B(33,18,i.totalGastos,"1.0-0")),h(6),et("$",B(39,21,i.balance,"1.0-0")),h(15),E(i.totalCertificados),h(7),E(i.totalReservas),h(7),P("data",i.chartDataCategoria)("type","doughnut"),h(7),P("data",i.chartDataIngresosGastos)("type","bar"),h(4),E(i.tituloTopCategorias),h(3),P("data",i.chartDataTopCategorias)("type","bar"),h(7),P("ngForOf",i.metricas))},dependencies:[Wt,zt,xe,Vt,$t,Jt,Qt,Xt,Zt,Yt,te,ee,re,oe,ae,ie,ne,se,fe,pe,le,de,me,ue,ce,Kt,qt,Ht,Ut,Ot,kt,Lt],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;width:100%;min-height:auto}.dashboard-wrapper[_ngcontent-%COMP%]{padding:8px 12px}ion-card[_ngcontent-%COMP%]{margin:8px 0;border-radius:10px;box-shadow:0 2px 6px #0003;background-color:var(--ion-background-color, #1e1e1e);padding:4px 0}ion-card-title[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;margin-bottom:6px;text-align:center;color:#fff}.dashboard-segment[_ngcontent-%COMP%]{margin:4px auto 10px;max-width:360px}.dashboard-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:18px 0 10px;text-align:center;color:#fff}.dashboard-chart-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;margin:10px auto 28px}canvas[_ngcontent-%COMP%]{width:90%;max-width:280px;height:auto!important;display:block}.movimientos-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: 42px;font-size:.85rem;line-height:1.1;padding-top:4px;padding-bottom:4px}@media (min-width: 768px){.dashboard-wrapper[_ngcontent-%COMP%]{padding:12px 16px}.dashboard-chart-container[_ngcontent-%COMP%]{margin-bottom:36px}canvas[_ngcontent-%COMP%]{max-width:340px}}.kpi-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-bottom:16px}.kpi-card[_ngcontent-%COMP%]{flex:1 1 45%;min-width:130px;text-align:center;background-color:#1e1e1e;border-radius:10px;box-shadow:0 2px 8px #00000040;padding:12px;color:#fff}.kpi-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;white-space:normal;word-break:break-word;margin-bottom:4px;text-align:center}.kpi-value[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#60a5fa;margin-top:2px}@media (max-width: 380px){.kpi-card[_ngcontent-%COMP%]{flex:1 1 100%}.kpi-title[_ngcontent-%COMP%]{font-size:.85rem}}']});let t=e;return t})();export{id as DashboardComponent};
